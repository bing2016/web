<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title>Ajax form</title>
	<link rel="stylesheet" type="text/css" href="https://www.w3schools.com/w3css/4/w3.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.js"></script>

	<style type="text/css">
		.w3-panel:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}
	</style>

</head>
<body>

	<form id="myForm" onsubmit="return false;" >
		Query:<br>
		<input class="w3-input" type="text" name="query" value=""><br>
		<button class="w3-btn w3-black" id="sendButton">Send Data</button>
	</form>
	<div class="w3-row">
		<div class="w3-col s6" style="margin-left: 20%">
			<div class="" id="TweetList"></div>
		</div>
	</div>	


	<script type="text/javascript">

		function sendAjaxQuery(url, data) {
			$.ajax({
				url: 'http://127.0.0.1:3000/postFile.html',
				dataType: "json",
				data: data,
				type: 'POST',
				success: function (data) {
					var ret = JSON.stringify(data);

					var twit = JSON.parse(ret).statuses;

					$("#TweetList").empty();

					initTable();
					function initTable () {
						var html = '<table border=0>';
						for(var i=0,l=twit.length;i<l;i++){
							var obj = twit[i];
							html += '<div class=" w3-panel w3-light-grey w3-round w3-border" onclick="openpage(\'https://twitter.com/' + obj.user.screen_name + '/status/' + obj.id_str + ' \')" >'
							// html += '<p>' + obj.created_at + '</p>';

							html += '<font style="color: black" size="5">Author: </font><a class="w3-btn" onclick="openpage(\'https://twitter.com/' + obj.user.screen_name + ' \')" ><img style="height:30px" src="' + obj.user.profile_image_url + '"><font style="color: black" size="5"> ' + obj.user.name + '</font><font style="color: grey" size="4">' + '@' + obj.user.screen_name + '. </font></a></p>'

							html += '<p><font style="color: black" size="3"> Date: </font><font style="color: grey" size="3">' + obj.created_at + '</font></p>';

							html += '<p><font style="color: black" size="5"> Tweet: ' + obj.text + '</font></p>'

							// for (var hashtag in obj.entities.hashtags) {
							// html +='<p>' + obj.entities.hashtags[hashtag].Text + '</p>'
							// }

							html += '</div>'
						}
						html += '</table>';

						$('#TweetList').append(html);
					}
				},
				error: function (xhr, status, error) {
					console.log('Error: ' + error.message);
					$('#lblResponse').html('Error connecting to the server.');
				},
			});
		}


		$.fn.serializeObject = function () {
			var o = {};
			var a = this.serializeArray();
			$.each(a, function () {
				if (o[this.name] !== undefined) {
					if (!o[this.name].push) {
						o[this.name] = [o[this.name]];
					}
					o[this.name].push(this.value || '');
				} else {
					o[this.name] = this.value || '';
				}
			});
			return o;
		};

		function sendData() {
			var form = document.getElementById('myForm');
			sendAjaxQuery('http://localhost:3000/', JSON.stringify($('form').serializeObject()));
		}	


		var sendButton = document.getElementById('sendButton');
		sendButton.onclick = sendData;

		function openpage(url){
			//window.location.replace(url);
			window.open(url);
		} 

	</script>

</body>
</html>